<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Racer toevoegen</title>
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script>
            'use strict'
            window.onload = init;
            function init(){
               for (var a of document.getElementsByTagName('a'))
                    {
                        a.addEventListener('click', function(e){
                            getNewPage(e.srcElement.getAttribute('url'));
                        })
                    }
            };
            function getNewPage(url){
                var content = document.getElementById('content');
                var newContent = '';
                switch (url){
                    case "male":
                        newContent = 'http://localhost:8081/list/gender/man';
                        break;
                    case 'female': 
                        newContent = 'http://localhost:8081/list/gender/vrouw';
                        break;
                    case 'all':
                        newContent = 'http://localhost:8081/list';
                        break;
                    case 'new':
                        newContent = 'http://localhost:8081/pages/new.html';
                        break;
                }
              var xml = new XMLHttpRequest();
              xml.open('GET', newContent);
              var states = new Array(200, 304, 201, 202);
              xml.onreadystatechange = function(){
                  if (states.indexOf(xml.status) != -1 && xml.readyState==4)
                    {
                        var content = document.getElementById('content');
                        content.innerHTML = '';
                        if (xml.getResponseHeader('Content-Type').toString().search(/text\/html/i))
                            {
                                content.innerHTML = xml.responseText;
                            }
                        else if (xml.getResponseHeader('Content-Type').toString().search(/application\/json/i))
                            {
                                var runners = JSON.parse(xml.responseText);
                                var ul = document.createElement('ul');
                                for (var runner of runners)
                                    {
                                        var li = document.createElement('li');
                                        li.innerHTML = runner.naam +' '+runner.achternaam+' ('+runner.gender+') heeft de race in '+runner.uren+' en '+runner.minuten+' gelopen.';
                                        ul.appendChild(li);
                                    }
                                content.appendChild(ul);
                            }
                    }
              }  
              xml.send();
            }

            function newRunner(event)
                {
                    event.preventDefault();
                    var xml = new XMLHttpRequest();
                    xml.open('POST', 'http://localhost:8081/addRunner');
                    xml.onreadystatechange = function(){
                        if (xml.status == 200)
                            {
                                if (xml.readyState == 0)
                                    {
                                        var balk = document.createElement('progress');
                                        balk.setAttribute('min', 0);
                                        balk.setAttribute('max', 0);
                                        balk.setAttribute('id', 'pro');
                                        balk.setAttribute('class', 'progress-bar');
                                        document.getElementById('balk').appendChild(balk);
                                    }
                                else 
                                    {
                                        document.getElementById('id').value = xml.readyState * 25
                                        
                                    }
                                if (xml.readyState == 4){
                                        document.getElementById('btn').removeAttribute('class');
                                        document.getElementById('btn').setAttribute('class', 'btn btn-success')
                                }
                            }
                        if (xml.status == 404)
                            {
                                document.getElementById('btn').removeAttribute('class');
                                document.getElementById('btn').setAttribute('class', 'btn btn-danger')
                            }
                        if (xml.status == 500)
                            {
                                document.getElementById('btn').removeAttribute('class');
                                document.getElementById('btn').setAttribute('class', 'btn btn-error')
                            }
                    }
                    var name = document.getElementById('name').value;
                    var lastname = document.getElementById('lastname').value;
                    var hour = document.getElementById('hour').value;
                    var minutes = document.getElementById('minutes').value;
                    var gender = document.getElementById('gender').value;
                    xml.send('name='+name
                    +'&lastname='+lastname
                    +'&hour='+hour
                    +'&minutes='+minutes
                    +'&gender='+gender
                    );
                }
        </script>
    </head>
    <body>
        <div class="container-fluid text-center">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <ul class="nav nav-tabs">
                        <li><a url="male" id="1">Male finishers</a></li>
                        <li><a url="female" id="2">Female finishers</a></li>
                        <li><a url="all" id="3">All finishers</a></li>
                        <li><a url="new" id="4" >Insert new finisher</a></li>
                    </ul>
                </div>
            </div>
            <div id="content">
                
            </div>
        </div>
    </body>
</html>